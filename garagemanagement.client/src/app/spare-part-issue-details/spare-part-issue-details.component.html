<div class="container mt-4">
  <h2 class="mb-3 text-primary fw-bold">
    <i class="bi bi-gear-fill me-2"></i> Spare Parts Issue Details
  </h2>

  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <form [formGroup]="partsForm" (ngSubmit)="onSubmit()">
    <div class="table-responsive">
      <table class="table table-bordered shadow-sm">
        <thead class="table-primary text-dark">
          <tr>
            <th>Sl.No.</th>
            <th>Part Description</th>
            <th>Part Number</th>
            <th>Make</th>
            <th>Unit Cost (₹)</th>
            <th>Qty</th>
            <th>Amount (₹)</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody formArrayName="parts">
          <tr *ngFor="let part of pagedParts; let i = index"
              [formGroupName]="((currentPage - 1) * pageSize) + i">
            <td>{{ i + 1 }}</td>

            <!-- Description -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('description')?.valid && part.get('description')?.value }">
                <input type="text" class="form-control" formControlName="description" />
              </div>
              <small class="text-danger" *ngIf="part.get('description')?.invalid && part.get('description')?.touched">
                Alphabets only
              </small>
            </td>

            <!-- Part Number -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('partNumber')?.valid && part.get('partNumber')?.value }">
                <input type="text" class="form-control" formControlName="partNumber" />
              </div>
              <small class="text-danger" *ngIf="part.get('partNumber')?.invalid && part.get('partNumber')?.touched">
                Alphanumeric & - _ / # allowed
              </small>
            </td>

            <!-- Make -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('make')?.valid && part.get('make')?.value }">
                <input type="text" class="form-control" formControlName="make" />
              </div>
              <small class="text-danger" *ngIf="part.get('make')?.invalid && part.get('make')?.touched">
                Alphabets only
              </small>
            </td>

            <!-- Unit Cost -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('unitCost')?.valid && part.get('unitCost')?.value }">
                <input type="text" class="form-control" formControlName="unitCost" />
              </div>
              <small class="text-danger" *ngIf="part.get('unitCost')?.invalid && part.get('unitCost')?.touched">
                Valid number (max 2 decimals)
              </small>
            </td>

            <!-- Qty -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('qty')?.valid && part.get('qty')?.value }">
                <input type="text" class="form-control" formControlName="qty" />
              </div>
              <small class="text-danger" *ngIf="part.get('qty')?.invalid && part.get('qty')?.touched">
                Numbers only
              </small>
            </td>

            <!-- Amount -->
            <td>{{ getAmount(((currentPage - 1) * pageSize) + i) | currency:'INR':'symbol' }}</td>

            <!-- Action -->
            <td>
              <button type="button" class="btn btn-outline-danger btn-sm"
                      (click)="removePart(((currentPage - 1) * pageSize) + i)">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap">
      <div>
        <button type="button" class="btn btn-outline-secondary me-2"
                (click)="prevPage()" [disabled]="currentPage === 1">
          ◀ Prev
        </button>
        <button type="button" class="btn btn-outline-secondary"
                (click)="nextPage()" [disabled]="currentPage === totalPages">
          Next ▶
        </button>
      </div>
      <span class="fw-bold">Page {{ currentPage }} / {{ totalPages }}</span>
    </div>

    <!-- Footer -->
    <div class="d-flex justify-content-between align-items-center mt-2 flex-wrap">
      <button type="button" class="btn btn-outline-primary mb-2" (click)="addPart()">
        <i class="bi bi-plus-circle"></i> Add Row
      </button>
      <h5 class="fw-bold mb-2">Total: {{ getTotalAmount() | currency:'INR':'symbol' }}</h5>
    </div>

    <div class="mt-3">
      <button type="submit" class="btn btn-success">
        <i class="bi bi-check-circle"></i> Submit
      </button>
    </div>
  </form>
</div>
