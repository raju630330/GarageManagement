
<section class="supervisor-section">
  <div class="container p-4">
    <form [formGroup]="partsForm" (ngSubmit)="onSubmit()">
      <div class="table-responsive">
        <table class="table table-bordered text-center align-middle">
          <thead>
            <tr>
              <th>Sl.No.</th>
              <th>Part Description</th>
              <th>Part Number</th>
              <th>Make</th>
              <th>Unit Cost (₹)</th>
              <th>Qty</th>
              <th>Amount (₹)</th>
              <th *appHasRole="'SparePartsIssueDetails'; permission: 'D'">Action</th>
            </tr>
          </thead>

          <tbody formArrayName="parts">
            <tr *ngFor="let part of pagedParts; let i = index"
                [formGroupName]="((currentPage - 1) * pageSize) + i">
              <td>{{ i + 1 }}</td>

              <!-- Description -->
              <td>
                <input type="text" class="form-control" formControlName="description" placeholder="Part Description" />
                <div class="text-danger" *ngIf="part.get('description')?.invalid && part.get('description')?.touched">
                  Alphabets only
                </div>
              </td>

              <!-- Part Number -->
              <td>
                <input type="text" class="form-control" formControlName="partNumber" placeholder="Part Number" />
                <div class="text-danger" *ngIf="part.get('partNumber')?.invalid && part.get('partNumber')?.touched">
                  Alphanumeric & - _ / # allowed
                </div>
              </td>

              <!-- Make -->
              <td>
                <input type="text" class="form-control" formControlName="make" placeholder="Make" />
                <div class="text-danger" *ngIf="part.get('make')?.invalid && part.get('make')?.touched">
                  Alphabets only
                </div>
              </td>

              <!-- Unit Cost -->
              <td>
                <input appTwoDecimalNumbers type="text" class="form-control" formControlName="unitCost" (input)="updateTotals()" placeholder="Unit Cost (₹)" />
                <div class="text-danger" *ngIf="part.get('unitCost')?.invalid && part.get('unitCost')?.touched">
                  Valid number (max 2 decimals)
                </div>
              </td>

              <!-- Qty -->
              <td>
                <input appNumbersOnly type="text" class="form-control" formControlName="qty" (input)="updateTotals()" placeholder="Qty" />
                <div class="text-danger" *ngIf="part.get('qty')?.invalid && part.get('qty')?.touched">
                  Numbers only
                </div>
              </td>

              <!-- Amount -->
              <td style="width: 100px;">{{ getAmount(((currentPage - 1) * pageSize) + i) | currency:'INR':'symbol' }}</td>

              <!-- Action -->
              <td *appHasRole="'SparePartsIssueDetails'; permission: 'D'">
                <button type="button" class="btn btn-outline-danger btn-sm"
                        title="Delete"
                        (click)="removePart(((currentPage - 1) * pageSize) + i)">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="6" class="text-end fw-bold">Total:</td>
              <td class="fw-bold">
                {{ getTotalAmount() | currency:'INR':'symbol' }}
              </td>
              <td *appHasRole="'SparePartsIssueDetails'; permission: 'D'"></td>
            </tr>
          </tfoot>

        </table>
      </div>     
      <!-- Pagination -->

      <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap">
        <div>
          <button type="button" class="btn btn-outline-secondary me-2"
                  (click)="prevPage()" [disabled]="currentPage === 1">
            ◀ Prev
          </button>
          <button type="button" class="btn btn-outline-secondary"
                  (click)="nextPage()" [disabled]="currentPage === totalPages">
            Next ▶
          </button>
        </div>
        <span class="fw-bold">Page {{ currentPage }} / {{ totalPages }}</span>
      </div>

      <div class="button-group mt-3">
        <button type="button" class="btn btn-add" (click)="addPart()">Add Row</button>
        <button type="submit" class="btn btn-submit">Submit</button>
      </div>

    </form>
  </div>
</section>
