
<section class="supervisor-section">
  <div class="container p-4">
    <form [formGroup]="partsForm" (ngSubmit)="onSubmit()">
      <table class="table table-bordered text-center align-middle">
        <thead class="table-primary">
          <tr>
            <th>Sl.No.</th>
            <th>Part Description</th>
            <th>Part Number</th>
            <th>Make</th>
            <th>Unit Cost (₹)</th>
            <th>Qty</th>
            <th>Amount (₹)</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody formArrayName="parts">
          <tr *ngFor="let part of pagedParts; let i = index"
              [formGroupName]="((currentPage - 1) * pageSize) + i">
            <td>{{ i + 1 }}</td>

            <!-- Description -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('description')?.valid && part.get('description')?.value }">
                <input type="text" class="form-control" formControlName="description" placeholder="Part Description" />
              </div>
              <small class="text-danger" *ngIf="part.get('description')?.invalid && part.get('description')?.touched">
                Alphabets only
              </small>
            </td>

            <!-- Part Number -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('partNumber')?.valid && part.get('partNumber')?.value }">
                <input type="text" class="form-control" formControlName="partNumber" placeholder="Part Number" />
              </div>
              <small class="text-danger" *ngIf="part.get('partNumber')?.invalid && part.get('partNumber')?.touched">
                Alphanumeric & - _ / # allowed
              </small>
            </td>

            <!-- Make -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('make')?.valid && part.get('make')?.value }">
                <input type="text" class="form-control" formControlName="make" placeholder="Make" />
              </div>
              <small class="text-danger" *ngIf="part.get('make')?.invalid && part.get('make')?.touched">
                Alphabets only
              </small>
            </td>

            <!-- Unit Cost -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('unitCost')?.valid && part.get('unitCost')?.value }">
                <input type="text" class="form-control" formControlName="unitCost" (input)="forceNumberswithtwodecimalsOnly(i,'unitCost'); updateTotals()" placeholder="Unit Cost (₹)" />
              </div>
              <small class="text-danger" *ngIf="part.get('unitCost')?.invalid && part.get('unitCost')?.touched">
                Valid number (max 2 decimals)
              </small>
            </td>

            <!-- Qty -->
            <td>
              <div class="cell-wrapper"
                   [ngClass]="{ 'cell-valid': part.get('qty')?.valid && part.get('qty')?.value }">
                <input type="text" class="form-control" formControlName="qty" (input)="forceNumbersOnly(i,'qty'); updateTotals()" placeholder="Qty" />
              </div>
              <small class="text-danger" *ngIf="part.get('qty')?.invalid && part.get('qty')?.touched">
                Numbers only
              </small>
            </td>

            <!-- Amount -->
            <td style="width: 100px;">{{ getAmount(((currentPage - 1) * pageSize) + i) | currency:'INR':'symbol' }}</td>

            <!-- Action -->
            <td>
              <button type="button" class="btn btn-outline-danger btn-sm"
                      title="Delete"
                      (click)="removePart(((currentPage - 1) * pageSize) + i)">
                <i class="bi bi-trash"></i>
              </button>
            </td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="table-secondary">
            <td colspan="6" class="text-end fw-bold">Total:</td>
            <td class="fw-bold">
              {{ getTotalAmount() | currency:'INR':'symbol' }}
            </td>
            <td></td>
          </tr>
        </tfoot>

      </table>

      <!-- Pagination -->

      <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap">
        <div>
          <button type="button" class="btn btn-outline-secondary me-2"
                  (click)="prevPage()" [disabled]="currentPage === 1">
            ◀ Prev
          </button>
          <button type="button" class="btn btn-outline-secondary"
                  (click)="nextPage()" [disabled]="currentPage === totalPages">
            Next ▶
          </button>
        </div>
        <span class="fw-bold">Page {{ currentPage }} / {{ totalPages }}</span>
      </div>

      <div class="button-group mt-3">
        <button type="button" class="btn btn-add" (click)="addPart()">Add Row</button>
        <button type="submit" class="btn btn-submit">Submit</button>
      </div>

    </form>

    <!-- Custom Alert Box -->
    <div class="custom-alert" *ngIf="showAlert">
      <div class="alert-content">
        <p>{{ alertMessage }}</p>

        <div class="alert-buttons" *ngIf="confirmAction">
          <button class="btn btn-danger" (click)="confirmYes()">Yes</button>
          <button class="btn btn-secondary" (click)="closeAlert()">No</button>
        </div>

        <div class="alert-buttons" *ngIf="!confirmAction">
          <button class="btn btn-primary" (click)="closeAlert()">OK</button>
        </div>
      </div>
    </div>
  </div>
</section>
