<div class="container-fluid py-5 bg-light min-vh-100">
  <!-- Header -->
  <div class="row justify-content-center mb-5">
    <div class="col-12 col-lg-10">
      <div class="card border-0 shadow-lg">
        <div class="card-body p-5 text-center bg-gradient-primary text-white rounded-top">
          <div class="row align-items-center">
            <div class="col-md-2 text-md-start">
              <i class="fas fa-car-mechanic fa-3x"></i>
            </div>
            <div class="col-md-8">
              <h1 class="display-5 fw-bold mb-2">Workshop Registration</h1>
              <p class="lead mb-0">Step <strong>{{currentStep}}</strong> of <strong>7</strong></p>
            </div>
          </div>
          <!-- Progress Bar -->
          <div class="progress mt-4 mx-auto shadow-sm" style="height: 12px; max-width: 420px;">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success rounded-pill position-relative"
                 role="progressbar"
                 [style.width.%]="progressPercentage"
                 [attr.aria-valuenow]="progressPercentage">
              <span class="position-absolute top-50 start-50 translate-middle px-2 py-1 bg-dark text-white rounded fw-bold small">
                {{progressPercentage}}%
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Form Content -->
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">
      <form [formGroup]="workshopForm" (ngSubmit)="submit()" novalidate>

        <!-- Step 1: Basic Information -->
        <div class="form-step card border-0 shadow-sm mb-4" [class.show]="currentStep === 1">
          <div class="card-header bg-primary text-white py-3">
            <h3 class="h4 mb-0">
              <i class="fas fa-info-circle me-2"></i>Basic Information
            </h3>
          </div>
          <div class="card-body p-4 p-md-5">
            <div class="row g-4">
              <div class="col-md-6">
                <label class="form-label ">Workshop Name </label>
                <input type="text" class="form-control" formControlName="workshopName"
                       placeholder="e.g., Sri Auto Works"
                       [class.is-invalid]="workshopForm.get('workshopName')?.invalid && workshopForm.get('workshopName')?.touched">
                <div class="invalid-feedback">
                  Workshop name required (2-100 characters)
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label ">Owner Name </label>
                <input type="text" class="form-control" formControlName="ownerName"
                       placeholder="e.g., Ramesh Kumar"
                       [class.is-invalid]="workshopForm.get('ownerName')?.invalid && workshopForm.get('ownerName')?.touched">
                <div class="invalid-feedback">Owner name required (2-100 characters)</div>
              </div>

              <div class="col-md-6">
                <label class="form-label ">Owner Mobile Number </label>
                <input type="tel" class="form-control" formControlName="ownerMobileNo"
                       placeholder="9876543210"
                       [class.is-invalid]="workshopForm.get('ownerMobileNo')?.invalid && workshopForm.get('ownerMobileNo')?.touched">
                <div class="invalid-feedback">
                  Enter valid 10-digit mobile (starts with 6-9)
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-control" formControlName="emailID"
                       placeholder="owner@workshop.com"
                       [class.is-invalid]="workshopForm.get('emailID')?.invalid && workshopForm.get('emailID')?.touched">
                <div class="invalid-feedback">Enter valid email address</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Landline</label>
                <input type="tel" class="form-control" formControlName="landline"
                       placeholder="040-12345678"
                       [class.is-invalid]="workshopForm.get('landline')?.invalid && workshopForm.get('landline')?.touched">
                <div class="invalid-feedback">Enter valid landline (10-15 digits)</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Contact Person</label>
                <input type="text" class="form-control" formControlName="contactPerson"
                       placeholder="Manager/Supervisor"
                       [class.is-invalid]="workshopForm.get('contactPerson')?.invalid && workshopForm.get('contactPerson')?.touched">
                <div class="invalid-feedback">Max 100 characters allowed</div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Contact Number</label>
                <input type="text" class="form-control" formControlName="contactNo"
                       placeholder="Contact Number"
                       [class.is-invalid]="workshopForm.get('contactNo')?.invalid && workshopForm.get('contactNo')?.touched">
                <div class="invalid-feedback">Enter valid Contact Number (10-15 digits)</div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-light">
            <div class="d-flex justify-content-end">
              <button type="button" class="btn btn-primary btn-lg px-4"
                      (click)="nextStep()">
                <i class="fas fa-arrow-right me-2"></i>Next: Address Details
              </button>
            </div>
          </div>
        </div>

        <!-- Step 2: Address -->
        <div class="form-step card border-0 shadow-sm mb-4" [class.show]="currentStep === 2">
          <div class="card-header bg-success text-white py-3">
            <h3 class="h4 mb-0">
              <i class="fas fa-map-marker-alt me-2"></i>Address Details
            </h3>
          </div>
          <div class="card-body p-4 p-md-5">
            <div formGroupName="address">
              <div class="row g-4">
                <div class="col-md-4">
                  <label class="form-label ">Door/Flat No.</label>
                  <input type="text" class="form-control" formControlName="flatNo"
                         placeholder="12/3"
                         [class.is-invalid]="addressForm.get('flatNo')?.invalid && addressForm.get('flatNo')?.touched">
                  <div class="invalid-feedback">Max 20 characters</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">Street</label>
                  <input type="text" class="form-control" formControlName="street"
                         placeholder="Main Road"
                         [class.is-invalid]="addressForm.get('street')?.invalid && addressForm.get('street')?.touched">
                  <div class="invalid-feedback">Max 100 characters</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">Location</label>
                  <input type="text" class="form-control" formControlName="location"
                         placeholder="Kukatpally"
                         [class.is-invalid]="addressForm.get('location')?.invalid && addressForm.get('location')?.touched">
                  <div class="invalid-feedback">Max 100 characters</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">City </label>
                  <input type="text" class="form-control" formControlName="city"
                         placeholder="Hyderabad"
                         [class.is-invalid]="addressForm.get('city')?.invalid && addressForm.get('city')?.touched">
                  <div class="invalid-feedback">City required (2-50 characters)</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">State </label>
                  <input type="text" class="form-control" formControlName="state"
                         placeholder="Telangana"
                         [class.is-invalid]="addressForm.get('state')?.invalid && addressForm.get('state')?.touched">
                  <div class="invalid-feedback">State required (2-50 characters)</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">Pincode </label>
                  <input type="text" class="form-control" formControlName="pincode" maxlength="6"
                         placeholder="500085"
                         [class.is-invalid]="addressForm.get('pincode')?.invalid && addressForm.get('pincode')?.touched">
                  <div class="invalid-feedback">Enter valid 6-digit pincode</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">State Code</label>
                  <input type="text" class="form-control" formControlName="stateCode" maxlength="2"
                         placeholder="TS"
                         [class.is-invalid]="addressForm.get('stateCode')?.invalid && addressForm.get('stateCode')?.touched">
                  <div class="invalid-feedback">Enter valid 2-letter state code (e.g., TS)</div>
                </div>

                <div class="col-12">
                  <label class="form-label ">Landmark</label>
                  <input type="text" class="form-control" formControlName="landmark"
                         placeholder="Near Apollo Hospital"
                         [class.is-invalid]="addressForm.get('landmark')?.invalid && addressForm.get('landmark')?.touched">
                  <div class="invalid-feedback">Max 100 characters</div>
                </div>

                <div class="col-12">
                  <label class="form-label ">Complete Address</label>
                  <textarea class="form-control" rows="3" formControlName="branchAddress"
                            placeholder="Enter full address for navigation..."></textarea>
                  <div class="invalid-feedback d-block"
                       *ngIf="addressForm.get('branchAddress')?.invalid && addressForm.get('branchAddress')?.touched">
                    Max 500 characters
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-light">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-outline-secondary px-4" (click)="prevStep()">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
              <button type="button" class="btn btn-success btn-lg px-4" (click)="nextStep()"
                      >
                Next: Business Info <i class="fas fa-arrow-right ms-2"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Step 3: Business Details -->
        <div class="form-step card border-0 shadow-sm mb-4" [class.show]="currentStep === 3">
          <div class="card-header bg-warning text-dark py-3">
            <h3 class="h4 mb-0">
              <i class="fas fa-chart-line me-2"></i>Business Details
            </h3>
          </div>
          <div class="card-body p-4 p-md-5">
            <div class="row g-4">
              <div class="col-md-3">
                <label class="form-label ">In Business Since</label>
                <input type="month" class="form-control" formControlName="inBusinessSince"
                       [class.is-invalid]="workshopForm.get('inBusinessSince')?.invalid && workshopForm.get('inBusinessSince')?.touched">
                <div class="invalid-feedback">Enter valid YYYY-MM format</div>
              </div>

              <div class="col-md-3">
                <label class="form-label ">Avg Vehicles/Month</label>
                <input type="number" class="form-control" formControlName="avgVehicleInflowPerMonth"
                       placeholder="50" min="1" max="10000"
                       [class.is-invalid]="workshopForm.get('avgVehicleInflowPerMonth')?.invalid && workshopForm.get('avgVehicleInflowPerMonth')?.touched">
                <div class="invalid-feedback">0-10000 vehicles</div>
              </div>

              <div class="col-md-3">
                <label class="form-label ">Employees</label>
                <input type="number" class="form-control" formControlName="noOfEmployees"
                       placeholder="15" min="1" max="1000"
                       [class.is-invalid]="workshopForm.get('noOfEmployees')?.invalid && workshopForm.get('noOfEmployees')?.touched">
                <div class="invalid-feedback">0-1000 employees</div>
              </div>

              <div class="col-md-3">
                <label class="form-label ">Dealer Code</label>
                <input type="text" class="form-control" formControlName="dealerCode"
                       placeholder="HYD001"
                       [class.is-invalid]="workshopForm.get('dealerCode')?.invalid && workshopForm.get('dealerCode')?.touched">
                <div class="invalid-feedback">Max 20 characters</div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-light">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-outline-secondary px-4" (click)="prevStep()">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
              <button type="button" class="btn btn-warning btn-lg px-4 text-dark " (click)="nextStep()" >
                Next: Operating Hours <i class="fas fa-arrow-right ms-2"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Step 4: Timing -->
        <div class="form-step card border-0 shadow-sm mb-4" [class.show]="currentStep === 4">
          <div class="card-header bg-info text-white py-3">
            <h3 class="h4 mb-0">
              <i class="fas fa-clock me-2"></i>Operating Hours
            </h3>
          </div>
          <div class="card-body p-4 p-md-5">
            <div formGroupName="timing">
              <div class="row g-4">
                <div class="col-md-6">
                  <label class="form-label ">Start Time </label>
                  <input type="time" class="form-control" formControlName="startTime"
                         [class.is-invalid]="timingForm.get('startTime')?.invalid && timingForm.get('startTime')?.touched">
                  <div class="invalid-feedback">Start time required</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label ">End Time </label>
                  <input type="time" class="form-control" formControlName="endTime"
                         [class.is-invalid]="timingForm.get('endTime')?.invalid && timingForm.get('endTime')?.touched">
                  <div class="invalid-feedback">End time required</div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-light">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-outline-secondary px-4" (click)="prevStep()">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
              <button type="button" class="btn btn-info btn-lg px-4 text-white" (click)="nextStep()"
                      >
                Next: Configuration <i class="fas fa-arrow-right ms-2"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Step 5: Business Config -->
        <div class="form-step card border-0 shadow-sm mb-4" [class.show]="currentStep === 5">
          <div class="card-header bg-secondary text-white py-3">
            <h3 class="h4 mb-0">
              <i class="fas fa-cog me-2"></i>Business Configuration
            </h3>
          </div>
          <div class="card-body p-4 p-md-5">
            <div formGroupName="businessConfig">
              <div class="row g-4">
                <div class="col-md-6">
                  <label class="form-label ">Website </label>
                  <input type="url" class="form-control" formControlName="websiteLink"
                         placeholder="https://yourworkshop.com"
                         [class.is-invalid]="businessConfigForm.get('websiteLink')?.invalid && businessConfigForm.get('websiteLink')?.touched">
                  <div class="invalid-feedback">Enter valid URL</div>
                </div>

                <div class="col-md-6">
                  <label class="form-label ">Google Reviews </label>
                  <input type="url" class="form-control" formControlName="googleReviewLink"
                         placeholder="https://g.page/yourworkshop"
                         [class.is-invalid]="businessConfigForm.get('googleReviewLink')?.invalid && businessConfigForm.get('googleReviewLink')?.touched">
                  <div class="invalid-feedback">Enter valid URL</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">GSTIN</label>
                  <input type="text" class="form-control" formControlName="gstin"
                         placeholder="29AACCC1234D1Z5"
                         [class.is-invalid]="businessConfigForm.get('gstin')?.invalid && businessConfigForm.get('gstin')?.touched">
                  <div class="invalid-feedback">Enter valid GSTIN format</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">MSME</label>
                  <input type="text" class="form-control" formControlName="msme"
                         placeholder="UDYAM-TS-01-0001234"
                         [class.is-invalid]="businessConfigForm.get('msme')?.invalid && businessConfigForm.get('msme')?.touched">
                  <div class="invalid-feedback">Max 50 characters</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">SAC Code</label>
                  <input type="text" class="form-control" formControlName="sac" maxlength="6"
                         placeholder="998314"
                         [class.is-invalid]="businessConfigForm.get('sac')?.invalid && businessConfigForm.get('sac')?.touched">
                  <div class="invalid-feedback">Enter valid 6-digit SAC code</div>
                </div>

                <div class="col-md-4">
                  <label class="form-label ">SAC Percentage</label>
                  <input type="text" class="form-control" formControlName="sacPercentage"
                         placeholder="18.5"
                         [class.is-invalid]="businessConfigForm.get('sacPercentage')?.invalid && businessConfigForm.get('sacPercentage')?.touched">
                  <div class="invalid-feedback">Enter valid percentage (e.g., 18.5)</div>
                </div>

                <div class="col-md-8">
                  <label class="form-label ">External Integration URL </label>
                  <input type="url" class="form-control" formControlName="externalIntegrationUrl"
                         placeholder="https://api.yourintegration.com"
                         [class.is-invalid]="businessConfigForm.get('externalIntegrationUrl')?.invalid && businessConfigForm.get('externalIntegrationUrl')?.touched">
                  <div class="invalid-feedback">Enter valid URL</div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-light">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-outline-secondary px-4" (click)="prevStep()">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
              <button type="button" class="btn btn-secondary btn-lg px-4" (click)="nextStep()" >
                Next: Services <i class="fas fa-arrow-right ms-2"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- STEP 6: Services & Configuration -->
        <div class="form-step card border-0 shadow-sm mb-4" [class.show]="currentStep === 6">
          <div class="card-header bg-danger text-white py-3">
            <h3 class="h4 mb-0">
              <i class="fas fa-tools me-2"></i>Services & Configuration
            </h3>
          </div>
          <div class="card-body p-4 p-md-5">
            <div class="row g-4">

              <!-- 1️⃣ Services -->
              <div class="col-md-6">
                <label class="form-label fw-bold">
                  Services <span class="text-danger">*</span>
                  ({{ serviceIdsArray.length }} selected)
                </label>

                <div class="border rounded p-3">
                  <div class="form-check" *ngFor="let service of availableServices">
                    <input type="checkbox"
                           class="form-check-input"
                           [id]="'service-' + service.id"
                           [checked]="isServiceChecked(service.id)"
                           (change)="onServiceChange(service.id, $event)">

                    <label class="form-check-label"
                           [for]="'service-' + service.id">
                      {{ service.name }}
                    </label>
                  </div>
                </div>

                <div class="text-danger mt-1" *ngIf="serviceIdsArray.length === 0">
                  Select at least 1 service
                </div>
              </div>

              <!-- 2️⃣ Working Days -->
              <div class="col-md-6">
                <label class="form-label fw-bold">
                  Working Days <span class="text-danger">*</span>
                </label>

                <div class="border rounded p-3">
                  <div class="form-check d-inline-block me-3"
                       *ngFor="let day of [0,1,2,3,4,5,6]">
                    <input class="form-check-input"
                           type="checkbox"
                           [id]="'day-' + day"
                           [checked]="isWorkingDayChecked(day)"
                           (change)="toggleWorkingDay(day)">

                    <label class="form-check-label"
                           [for]="'day-' + day">
                      {{ getDayName(day) }}
                    </label>
                  </div>
                </div>

                <span class="badge bg-info mt-2">
                  {{ workingDaysArray.length }} / 7 selected
                </span>
                <div class="text-danger mt-1" *ngIf="workingDaysArray.length < 5">
                  Working days must be 5
                </div>
              </div>

              <!-- 3️⃣ Payment Modes -->
              <div class="col-md-6">
                <label class="form-label fw-bold">
                  Payment Modes <span class="text-danger">*</span>
                  ({{ paymentModeIdsArray.length }} selected)
                </label>

                <div class="border rounded p-3">
                  <div class="form-check" *ngFor="let payment of availablePaymentModes">
                    <input type="checkbox"
                           class="form-check-input"
                           [id]="'pay-' + payment.id"
                           [checked]="isPaymentModeChecked(payment.id)"
                           (change)="onPaymentModeChange(payment.id, $event)">

                    <label class="form-check-label"
                           [for]="'pay-' + payment.id">
                      {{ payment.name }}
                    </label>
                  </div>
                </div>

                <div class="text-danger mt-1" *ngIf="paymentModeIdsArray.length === 0">
                  Select at least 1 payment mode
                </div>
              </div>

              <!-- 4️⃣ Media Upload -->
              <div class="col-md-6">
                <label class="form-label fw-bold">
                  Media Upload <span class="text-danger">*</span>
                </label>

                <!-- File input -->
                <input type="file"
                       class="form-control"
                       multiple
                       accept="image/*"
                       (change)="onFileSelected($event)" />

                <!-- Selected count -->
                <small class="text-muted d-block mt-1">
                  {{ selectedFiles.length + existingMedia.length }} file(s) selected
                </small>

                <!-- Validation -->
                <div class="text-danger mt-1"
                     *ngIf="(selectedFiles.length + existingMedia.length) === 0">
                  Please select at least 1 file
                </div>

                <!-- EXISTING FILES (EDIT MODE) -->
                <ul class="list-group mt-2" *ngIf="existingMedia.length > 0">
                  <li class="list-group-item py-1 d-flex justify-content-between align-items-center"
                      *ngFor="let file of existingMedia; let i = index">
                    <span class="text-primary"
                          style="cursor:pointer"
                          (click)="viewImage(file.fileUrl)">
                      {{ file.fileName }}
                    </span>
                  </li>
                </ul>

                <!-- NEWLY SELECTED FILES -->
                <ul class="list-group mt-2" *ngIf="selectedFiles.length > 0">
                  <li class="list-group-item py-1 d-flex justify-content-between align-items-center"
                      *ngFor="let file of selectedFiles; let i = index">
                    {{ file.name }}
                    <button type="button"
                            class="btn btn-sm btn-outline-danger"
                            (click)="removeFile(i)">
                      ✕
                    </button>
                  </li>
                </ul>
              </div>

            </div>
          </div>
          <div class="card-footer bg-light">
            <div class="d-flex justify-content-between">
              <button type="button"
                      class="btn btn-outline-secondary px-4"
                      (click)="prevStep()">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>

              <button type="button"
                      class="btn btn-danger btn-lg px-4"
                      (click)="nextStep()">
                Next: GDPR Agreement
                <i class="fas fa-arrow-right ms-2"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- STEP 7: GDPR Agreement (Final) -->
        <div class="form-step card border-0 shadow-sm mb-4" [class.show]="currentStep === 7">
          <div class="card-header bg-dark text-white py-3">
            <h3 class="h4 mb-0"><i class="fas fa-file-contract me-2"></i>Review & Agree</h3>
          </div>
          <div class="card-body p-4 p-md-5">
            <div class="row">
              <div class="col-12">
                <div class="alert alert-info">
                  <h6>✅ Review your workshop details:</h6>
                  <ul class="mb-0">
                    <li><strong>{{workshopForm.get('workshopName')?.value || 'Not set'}}</strong></li>
                    <li>{{serviceIdsArray.length}} services, {{workingDaysArray.length}} working days</li>
                    <li>Ready to create workshop!</li>
                  </ul>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" formControlName="isGdprAccepted" id="gdprCheck">
                  <label class="form-check-label fw-bold" for="gdprCheck">
                    <i class="fas fa-shield-alt me-2 text-warning"></i>
                    I accept GDPR compliance and Terms & Conditions <span class="text-danger">*</span>
                  </label>
                  <div class="text-danger mt-1"
                       *ngIf="workshopForm.get('isGdprAccepted')?.value == false">
                    Please accept GDPR compliance and Terms & Conditions
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-footer bg-light">
            <div class="d-flex justify-content-between">
              <button type="button" class="btn btn-outline-secondary px-4" (click)="prevStep()">
                <i class="fas fa-arrow-left me-2"></i>Back
              </button>
              <button type="submit" class="btn btn-success btn-lg px-5" >
                <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
                {{ isSubmitting ? 'Creating...' : '✅ CREATE WORKSHOP' }}
              </button>
            </div>
          </div>
        </div>

      </form>
    </div>
  </div>
</div>
