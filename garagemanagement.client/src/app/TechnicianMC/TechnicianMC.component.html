<form [formGroup]="repairTForm" (ngSubmit)="onSubmit()">
  <div class="container mt-4">

    <!-- SUCCESS MESSAGE -->
    <div *ngIf="showSuccess" class="success-overlay">
      <div class="success-box">
        ✅ Data saved successfully!
      </div>
    </div>

    <!-- CHECKLIST TABLE -->
    <div class="table-responsive">
      <table class="table table-bordered align-middle">
        <tbody>
          <tr *ngFor="let leftItem of TMCLeft; let idx = index">

            <!-- LEFT COLUMN -->
            <td class="text-start w-50" *ngIf="leftItem">
              <div class="d-flex flex-column gap-1">

                <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-semibold">{{ leftItem.label }}</span>

                  <div class="d-flex gap-3">
                    <label class="d-flex align-items-center gap-1">
                      <input type="checkbox"
                             [checked]="leftItem.status === 'ok'"
                             (change)="setStatus(leftItem, 'ok')" />
                      OK
                    </label>

                    <label class="d-flex align-items-center gap-1">
                      <input type="checkbox"
                             [checked]="leftItem.status === 'notOk'"
                             (change)="setStatus(leftItem, 'notOk')" />
                      NOT OK
                    </label>
                  </div>
                </div>

                <!-- PER-ROW VALIDATION -->
                <div *ngIf="isSubmitted && leftItem.touched && !leftItem.status"
                     class="text-danger">
                  <small>⚠ Please select OK or NOT OK</small>
                </div>

              </div>
            </td>

            <!-- RIGHT COLUMN -->
            <td class="text-start w-50" *ngIf="TMCRight[idx]">
              <div class="d-flex flex-column gap-1">

                <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-semibold">{{ TMCRight[idx].label }}</span>

                  <div class="d-flex gap-3">
                    <label class="d-flex align-items-center gap-1">
                      <input type="checkbox"
                             [checked]="TMCRight[idx].status === 'ok'"
                             (change)="setStatus(TMCRight[idx], 'ok')" />
                      OK
                    </label>

                    <label class="d-flex align-items-center gap-1">
                      <input type="checkbox"
                             [checked]="TMCRight[idx].status === 'notOk'"
                             (change)="setStatus(TMCRight[idx], 'notOk')" />
                      NOT OK
                    </label>
                  </div>
                </div>

                <!-- PER-ROW VALIDATION -->
                <div *ngIf="isSubmitted && TMCRight[idx].touched && !TMCRight[idx].status"
                     class="text-danger">
                  <small>⚠ Please select OK or NOT OK</small>
                </div>

              </div>
            </td>

          </tr>
        </tbody>
      </table>
    </div>

    <!-- DECLARATION -->
    <div class="mb-3 p-3 border rounded bg-light">
      <label class="d-flex align-items-start gap-2">
        <input type="checkbox" formControlName="confirmation" />
        <span>
          I hereby state that I checked thoroughly in line with the above parameters,
          explained the same to the driver, and he agreed to take delivery with satisfaction.
        </span>
      </label>

      <div *ngIf="confirmation?.invalid && isSubmitted" class="text-danger mt-1">
        Confirmation is required.
      </div>
    </div>

    <!-- REMARKS -->
    <div class="mb-3">
      <label class="form-label fw-bold">Remarks</label>
      <textarea class="form-control"
                rows="3"
                formControlName="remarks"
                placeholder="Enter remarks"></textarea>

      <div class="text-danger" *ngIf="remarks?.invalid && (remarks?.dirty || isSubmitted)">
        <small>Remarks are required.</small>
      </div>
    </div>

    <!-- SIGNATURES -->
    <div class="table-responsive">
      <table class="table table-bordered text-center align-middle">
        <thead class="table-secondary">
          <tr>
            <th>Technician</th>
            <th>Driver</th>
            <th>Floor Supervisor</th>
            <th>Authorised Person</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <input type="text" class="form-control" formControlName="technicianSign" />
              <small class="text-danger"
                     *ngIf="technicianSign?.invalid && (technicianSign?.dirty || isSubmitted)">
                Technician name required (2–20 chars)
              </small>
            </td>

            <td>
              <input type="text" class="form-control" formControlName="driverSign" />
              <small class="text-danger"
                     *ngIf="driverSign?.invalid && (driverSign?.dirty || isSubmitted)">
                Driver name required (2–20 chars)
              </small>
            </td>

            <td>
              <input type="text" class="form-control" formControlName="floorSign" />
              <small class="text-danger"
                     *ngIf="floorSign?.invalid && (floorSign?.dirty || isSubmitted)">
                Floor Supervisor name required
              </small>
            </td>

            <td>
              <input type="text" class="form-control" formControlName="authSign" />
              <small class="text-danger"
                     *ngIf="authSign?.invalid && (authSign?.dirty || isSubmitted)">
                Authorised Person name required
              </small>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- SUBMIT -->
    <div class="text-center mt-4">
      <button class="btn btn-primary px-4" type="submit">
        Submit
      </button>
    </div>

  </div>
</form>
