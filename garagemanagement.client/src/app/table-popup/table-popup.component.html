<!-- Horizontal Menu -->
<ul class="nav nav-pills mb-3 bg-primary p-2 rounded">
  <li class="nav-item" *ngFor="let tab of data.tabs">
    <a style="cursor:pointer" class="nav-link text-white"
       [ngClass]="{ 'active bg-success text-dark': activeTab === tab }"
       (click)="setTab(tab)">
      {{ tab }}
    </a>
  </li>
</ul>

<mat-dialog-content [formGroup]="form">

  <!-- ================= TYRE/BATTERY ================= -->
  <div *ngIf="activeTab === 'TYRE/BATTERY'">
    <table class="table table-bordered table-sm text-center">
      <thead>
        <tr>
          <th>Type</th>
          <th>Brand</th>
          <th>Model</th>
          <th>Manufacture Date</th>
          <th>Expiry Date</th>
          <th>Condition</th>
          <th></th>
        </tr>
      </thead>
      <tbody formArrayName="tyreBattery">
        <tr *ngFor="let row of getArray('TYRE/BATTERY').controls; let i=index" [formGroupName]="i">
          <td>
            <select class="form-select form-select-sm" formControlName="type">
              <option value="">Select Type</option>
              <option>Tyre</option>
              <option>Battery</option>
            </select>
            <div *ngIf="row.get('type')?.invalid && row.get('type')?.touched" class="text-danger small">Select Type</div>
          </td>
          <td>
            <select class="form-select form-select-sm" formControlName="brand">
              <option value="">Select Brand</option>
              <option *ngFor="let b of (row.get('type')?.value === 'Tyre'
                              ? ['MRF', 'Apollo', 'JK']
                              : row.get('type')?.value === 'Battery'
                              ? ['Exide', 'Amaron', 'SF Sonic']
                              : [])"
                      [value]="b">
                {{ b }}
              </option>
            </select>
            <div *ngIf="row.get('brand')?.invalid && row.get('brand')?.touched" class="text-danger small">
              Brand is required
            </div>
          </td>
          <td>
            <input class="form-control form-control-sm" formControlName="model">
            <div *ngIf="row.get('model')?.invalid && row.get('model')?.touched" class="text-danger small">Model is required</div>
          </td>
          <td>
            <input type="date" class="form-control form-control-sm" formControlName="manufactureDate">
            <div *ngIf="row.get('manufactureDate')?.invalid && row.get('manufactureDate')?.touched" class="text-danger small">Manufacture Date is required</div>
          </td>
          <td>
            <input type="date" class="form-control form-control-sm" formControlName="expiryDate">
            <div *ngIf="row.get('expiryDate')?.invalid && row.get('expiryDate')?.touched" class="text-danger small">Expiry Date is required</div>
          </td>
          <td>
            <select class="form-select form-select-sm" formControlName="condition">
              <option value="" selected>Select Condition</option>
              <option>New</option>
              <option>Used</option>
              <option>Damaged</option>
            </select>
            <div *ngIf="row.get('condition')?.invalid && row.get('condition')?.touched" class="text-danger small">Condition is required</div>
          </td>
          <td *appHasRole="[ROLES.ADMIN]">
            <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeRow('TYRE/BATTERY', i)" title="Delete"><i class="bi bi-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ================= CANCELLED INVOICES ================= -->
  <div *ngIf="activeTab === 'CANCELLED INVOICES'">
    <table class="table table-bordered table-sm text-center">
      <thead>
        <tr>
          <th>Sl No.</th>
          <th>Invoice No.</th>
          <th>Invoice Date</th>
          <th>Invoice Amount</th>
          <th></th>
        </tr>
      </thead>
      <tbody formArrayName="cancelledInvoices">
        <tr *ngFor="let row of getArray('CANCELLED INVOICES').controls; let i=index" [formGroupName]="i">
          <td>{{ i + 1 }}</td>
          <td>
            <input class="form-control form-control-sm" formControlName="invoiceNo">
            <div *ngIf="row.get('invoiceNo')?.invalid && row.get('invoiceNo')?.touched" class="text-danger small">Invoice No is required</div>
          </td>
          <td>
            <input type="date" class="form-control form-control-sm" formControlName="date">
            <div *ngIf="row.get('date')?.invalid && row.get('date')?.touched" class="text-danger small">Invoice Date is required</div>
          </td>
          <td>
            <input appTwoDecimalNumbers class="form-control form-control-sm" formControlName="amount">
            <div *ngIf="row.get('amount')?.invalid && row.get('amount')?.touched" class="text-danger small">Amount is required & must be ≥0</div>
          </td>
          <td *appHasRole="[ROLES.ADMIN]">
            <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeRow('CANCELLED INVOICES', i)" title="Delete"><i class="bi bi-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ================= SERVICE SUGGESTIONS ================= -->
  <div *ngIf="activeTab === 'SERVICE SUGGESTIONS'">
    <textarea class="form-control"
              formControlName="serviceSuggestions"
              placeholder="Enter service suggestions">
  </textarea>

    <div class="text-danger small"
         *ngIf="form.get('serviceSuggestions')?.invalid
           && form.get('serviceSuggestions')?.touched">
      Suggestion is required
    </div>
  </div>


  <!-- ================= COLLECTIONS ================= -->
  <div *ngIf="activeTab === 'COLLECTIONS'">
    <table class="table table-bordered table-sm text-center">
      <thead>
        <tr>
          <th>Type</th>
          <th>Bank Name</th>
          <th>Cheque No</th>
          <th>Amount</th>
          <th>Date</th>
          <th>Invoice No</th>
          <th>Remarks</th>
          <th></th>
        </tr>
      </thead>
      <tbody formArrayName="collections">
        <tr *ngFor="let row of getArray('COLLECTIONS').controls; let i=index" [formGroupName]="i">
          <td>
            <select class="form-select form-select-sm" formControlName="type">
              <option value="">Select Type</option>
              <option>Cash</option>
              <option>Cheque</option>
              <option>UPI</option>
            </select>
            <div *ngIf="row.get('type')?.invalid && row.get('type')?.touched" class="text-danger small">Type is required</div>
          </td>
          <td>
            <select class="form-select form-select-sm" formControlName="bank">
              <option value="" disabled>Select Bank</option>
              <option>State Bank of India</option>
              <option>HDFC</option>
              <option>ICICI</option>
              <option>Axis Bank</option>
              <option>PNB</option>
            </select>
            <div *ngIf="row.get('bank')?.invalid && row.get('bank')?.touched" class="text-danger small">Bank is required</div>
          </td>
          <td>
            <input class="form-control form-control-sm" formControlName="chequeNo">
            <div *ngIf="row.get('chequeNo')?.invalid && row.get('chequeNo')?.touched" class="text-danger small">Cheque No. is required</div>
          </td>
          <td>
            <input appTwoDecimalNumbers class="form-control form-control-sm" formControlName="amount">
            <div *ngIf="row.get('amount')?.invalid && row.get('amount')?.touched" class="text-danger small">Amount is required & must be ≥0</div>
          </td>
          <td>
            <input type="date" class="form-control form-control-sm" formControlName="date">
            <div *ngIf="row.get('date')?.invalid && row.get('date')?.touched" class="text-danger small">Date is required</div>
          </td>
          <td>
            <input class="form-control form-control-sm" formControlName="invoiceNo">
            <div *ngIf="row.get('invoiceNo')?.invalid && row.get('invoiceNo')?.touched" class="text-danger small">Invoice No is required</div>
          </td>
          <td>
            <input class="form-control form-control-sm" formControlName="remarks">
            <div *ngIf="row.get('remarks')?.invalid && row.get('remarks')?.touched" class="text-danger small">Remarks is required</div>
          </td>
          <td *appHasRole="[ROLES.ADMIN]">
            <button type="button" class="btn btn-outline-danger btn-sm" (click)="removeRow('COLLECTIONS', i)" title="Delete"><i class="bi bi-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- ================= REMARKS ================= -->
  <div *ngIf="activeTab === 'REMARKS'">
    <textarea class="form-control"
              formControlName="remarks"
              placeholder="Enter remarks">
    </textarea>

    <div class="text-danger small"
         *ngIf="form.get('remarks')?.invalid
         && form.get('remarks')?.touched">
      Remarks is required
    </div>
  </div>

</mat-dialog-content>

<mat-dialog-actions class="d-flex align-items-center">

  <!-- ADD BUTTON (only when needed) -->
  <button *ngIf="activeTab !== 'SERVICE SUGGESTIONS' && activeTab !== 'REMARKS'"
          class="btn btn-primary btn-sm"
          (click)="addRow(activeTab)">
    + Add
  </button>

  <!-- CLOSE BUTTON (always at END) -->
  <button mat-raised-button
          color="warn"
          class="ms-auto"
          (click)="close()">
    Close
  </button>

</mat-dialog-actions>

